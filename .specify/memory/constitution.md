<!-- SYNC IMPACT REPORT
Version change: 1.0.0 → 2.0.0
Modified principles: All principles replaced with new architecture-focused principles
Added sections: Statelessness Principle, Agent-Centric Control Model, MCP Server Constitution, Conversation Persistence Constitution
Removed sections: Old principles about Next.js architecture, authentication, etc.
Templates requiring updates: ⚠ pending review - .specify/templates/plan-template.md, .specify/templates/spec-template.md, .specify/templates/tasks-template.md, .specify/templates/commands/*.md
Follow-up TODOs: Update all template files to align with new constitution
-->

# AI-Powered Todo Management Chatbot Constitution

## 1. System Identity & Purpose

This system is an AI-powered Todo Management Chatbot built using Agentic Development Stack principles.
The system enables users to manage todos using natural language, while strictly following a stateless server architecture.

The core purpose of this system is to:

- Translate user intent into structured task operations
- Execute those operations via MCP tools
- Persist all state in a database
- Maintain zero in-memory state on the server between requests

## 2. Architectural Constitution

### 2.1 Statelessness Principle (Non-Negotiable)

The server must never retain session state in memory

Each request is treated as an independent execution cycle

Conversation continuity is achieved only via database persistence

MCP tools are also stateless and rely exclusively on database I/O

Violation of this rule is considered a critical architectural failure.

### 2.2 Agent-Centric Control Model

All business logic decisions are made by AI agents

No hard-coded control flow for task logic is allowed

The agent:
- Interprets user intent
- Decides which MCP tool(s) to call
- Determines response structure

Developers do not write manual task logic, only specifications and prompts.

## 3. Development Process Constitution (Spec-Kit Plus)

The system must be developed strictly using the following Agentic Dev Stack flow:

- Write Spec
  - Define system behavior, constraints, tools, and data models
- Generate Plan
  - Agent creates an execution plan from the spec
- Break Into Tasks
  - Agent decomposes plan into actionable implementation tasks
- Implement via AI
  - All code is generated by AI (means you)
  - Manual coding is prohibited

Each phase must be preserved for review and evaluation.

## 4. AI Behavior & Reasoning Rules

### 4.1 Intent Interpretation

The AI agent must:
- Parse natural language input
- Infer user intent (create, update, delete, list, complete todo)
- Resolve ambiguity using context from conversation history
- If intent is unclear, the agent must ask a clarifying question instead of guessing.

### 4.2 Tool Invocation Discipline

The agent must not simulate results

All task operations must go through MCP tools

Multiple tools may be called in a single turn if required

Example:
- "Mark all today's tasks as done" → listTodos → updateTodo (loop)

## 5. MCP Server Constitution

### 5.1 Tool Exposure Rules

The MCP server must expose task operations only as tools, such as:
- createTodo
- updateTodo
- deleteTodo
- listTodos
- completeTodo

Each tool:
- Accepts structured input
- Performs a single responsibility
- Persists changes using SQLModel + Neon PostgreSQL

### 5.2 Stateless Tool Contract

MCP tools:
- Do not cache
- Do not track sessions
- Do not infer history
- All required context must be passed explicitly

## 6. Conversation Persistence Constitution

### 6.1 Conversation Model

Every user and assistant message is stored in the database

Each message includes:
- role (user | assistant)
- content
- timestamp
- conversation_id

### 6.2 Stateless Request Cycle (Mandatory Flow)

For every request, the system must follow exactly this sequence:
1. Receive user message
2. Fetch full conversation history from database
3. Build agent message array (history + new input)
4. Persist user message
5. Run AI agent using OpenAI Agents SDK
6. Agent invokes MCP tool(s)
7. Persist assistant response
8. Return response to frontend
9. Server resets to empty state

## 7. Technology Governance Rules

### 7.1 Approved Stack (Locked)

- Frontend: Next.js (modern/custom UI)
- Backend: Next.js API routes
- AI Framework: OpenAI Agents SDK
- MCP Server: Official MCP SDK
- ORM: SQLModel
- Database: Neon Serverless PostgreSQL
- Authentication: Better Auth

No substitutions or shortcuts are allowed.

## 8. Authentication & Data Isolation

Every todo is strictly scoped to an authenticated user

Agents must only access data belonging to the current user

MCP tools must validate user identity before execution

## 9. Error Handling & Safety

The agent must:
- Gracefully handle tool failures
- Explain errors in human-friendly language
- Never expose stack traces or raw SQL errors

## 10. Evaluation Alignment Clause

This system is designed to be evaluated on:
- Correct use of Spec-Kit Plus
- Proper agentic workflow
- Stateless architecture correctness
- Clean separation of AI reasoning and tool execution
- Quality of specs, plans, and iterations (not just final output)

## 11. Final Authority Rule

If there is a conflict between:
- Manual logic vs agent decision
- Stateful convenience vs stateless architecture

This constitution always wins.

**Version**: 2.0.0 | **Ratified**: 2025-06-13 | **Last Amended**: 2026-01-07